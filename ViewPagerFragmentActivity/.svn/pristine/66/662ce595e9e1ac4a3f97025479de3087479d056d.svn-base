package edu.purdue.spm;




import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.net.Socket;
import java.util.concurrent.ExecutionException;

import android.os.AsyncTask;
import android.os.Bundle;
import android.app.Activity;
import android.content.Intent;
import android.util.Log;
import android.view.Menu;
import android.view.View;
import android.widget.Button;
import android.widget.CheckedTextView;

public class LobbyActivity extends Activity {

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_lobby);

		final CheckedTextView contactBookTextView = (CheckedTextView) findViewById(R.id.contact_book_textview);
		//Listening to button event
		
		final Button connectButton = (Button)findViewById(R.id.connect_button);
		connectButton.setOnClickListener(new View.OnClickListener() {

			@Override
			public void onClick(View v) {
				String msg = "aaa";
				try {
					msg = (String) new ContactServerTask().execute().get();
				} catch (InterruptedException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				} catch (ExecutionException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
				Log.i("MSG", "LaLaLa");	
				contactBookTextView.setText(msg);
			}
		});
		
		
		contactBookTextView.setOnClickListener(new View.OnClickListener() {

			public void onClick(View arg0) {
				//Starting a new Intent
				Intent gotoCommendCenterListActivity = new Intent(getApplicationContext(), ContactBookListActivity.class);

				//Sending data to another Activity
				gotoCommendCenterListActivity.putExtra("userId", contactBookTextView.getText().toString());

				// starting new activity
				startActivity(gotoCommendCenterListActivity);

			}
		});
	}

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.activity_lobby, menu);
		return true;
	}
	
	private class ContactServerTask extends AsyncTask<Object, Object, Object> {

            private Exception exception;

            @Override
            protected String doInBackground(Object... params) {
                    Socket socket = null;
                    DataOutputStream dataOutputStream = null;
                    DataInputStream dataInputStream = null;
                    try{
                            Log.i("MSG", "Trying...\n");
                            socket = new Socket("172.18.40.16", 10000);
                            Log.i("MSG", "Connected...\n");
                            dataOutputStream = new DataOutputStream(socket.getOutputStream());
                            dataInputStream = new DataInputStream(socket.getInputStream());
                            dataOutputStream.writeUTF("Android");
                            socket.close();
                    }catch(Exception e){
                  	  return e.getMessage();
                    }
                    return "Success";
            }
    }
}
